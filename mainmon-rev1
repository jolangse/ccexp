function mprogressbar(mon, size, cur, max, char)
        char = char or "#"
        local xpos,ypos = mon.getCursorPos()

		mon.write("[")
		mon.setCursorPos(xpos+size-1, ypos)
		mon.write("]")
		fract = cur / max
		len = math.ceil( (size-2) * fract)
		start = xpos
		for i = 1, len do
			start = start + 1
			mon.setCursorPos(start, ypos)
			mon.write(char)
		end
end 

function progressbar(size, cur, max, char)
        char = char or "#"
        local xpos,ypos = term.getCursorPos()

		print("[")
		term.setCursorPos(xpos+size-1, ypos)
		print("]")
		fract = cur / max
		len = math.ceil( (size-2) * fract)
		start = xpos
		for i = 1, len do
			start = start + 1
			term.setCursorPos(start, ypos)
			print(char)
		end
end 

monitor = peripheral.wrap("left")
monitor.setBackgroundColor(colors.blue)
monitor.setTextScale(0.5)
monitor.clear()
monitor.setCursorPos(4,2)
monitor.write("jolangse inc systems monitor")

rednet.open("top")

rednet.send(183, "powerpct")
id, pct = rednet.receive(1)
monitor.setCursorPos(2,4)
monitor.write("Main battery state:")
monitor.setCursorPos(2,5)
mprogressbar(monitor, 20, pct, 100)
monitor.setCursorPos(23, 5)
monitor.write(" " .. pct .. "%")
print("Main battery is at " .. pct .. "%")

rednet.send(176, "powerpct")
id, pct = rednet.receive(1)
monitor.setCursorPos(2,6)
monitor.write("Core battery state:")
monitor.setCursorPos(2,7)
mprogressbar(monitor, 20, pct, 100)
monitor.setCursorPos(23, 7)
monitor.write(" " .. pct .. "%")
print("Core battery is at " .. pct .. "%")

