function progressbar(size, cur, max, char)
        char = char or "#"
        local xpos,ypos = term.getCursorPos()

		print("[")
		term.setCursorPos(xpos+size-1, ypos)
		print("]")
		fract = cur / max
		len = math.ceil( (size-2) * fract)
		start = xpos
		for i = 1, len do
			start = start + 1
			term.setCursorPos(start, ypos)
			print(char)
		end
end 

rednet.open("top")

rednet.send(183, "power")
id, plvl = rednet.receive(1)

os.sleep(1) -- Slow down, let it keep up...

rednet.send(183, "powermax")
id, pmax = rednet.receive(1)

print("Main battery state:")
if plvl and pmax then
  pct = math.ceil(plvl * 100 / pmax)
  local xpos,ypos = term.getCursorPos()
  progressbar(20, plvl, pmax)
  term.setCursorPos(xpos, ypos+21)
  print(" " .. pct "%")
end

